<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2246px" preserveAspectRatio="none" style="width:1625px;height:2246px;background:#FFFFFF;" version="1.1" viewBox="0 0 1625 2246" width="1625px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cqnep3rlh27r" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#F5F5F5" height="2234.7422" style="stroke:#A80036;stroke-width:1.0;" width="454" x="220" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="93" x="398" y="22.708">Endgerät</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="496" y="23.8872"/><rect fill="#F5F5F5" height="2234.7422" style="stroke:#A80036;stroke-width:1.0;" width="689" x="906" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="200" x="1148" y="22.708">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="1353" y="23.8872"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="1731.1953" style="stroke:#000000;stroke-width:1.0;" width="10" x="328" y="317.9844"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="556" y="717.6328"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="717.6328"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="1022.9453"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1464.5078"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1815.4453"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="515.8984"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="284.5234" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="944.3672"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1564.875"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1915.8125"/><rect fill="#F0F8FF" filter="url(#f1cqnep3rlh27r)" height="817.5391" style="stroke:#000000;stroke-width:2.0;" width="1472" x="10" y="444.3516"/><rect fill="#FFFFFF" filter="url(#f1cqnep3rlh27r)" height="781.2891" style="stroke:#000000;stroke-width:2.0;" width="1601" x="10" y="1300.8906"/><rect fill="#FFFFFF" filter="url(#f1cqnep3rlh27r)" height="311.9375" style="stroke:#000000;stroke-width:2.0;" width="1387" x="214" y="1353.5156"/><rect fill="#FFFFFF" filter="url(#f1cqnep3rlh27r)" height="311.9375" style="stroke:#000000;stroke-width:2.0;" width="1387" x="214" y="1704.4531"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="116" x2="116" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="333" x2="333" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="561" x2="561" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="790" x2="790" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1019" x2="1019" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1247" x2="1247" y1="118.5625" y2="2124.1797"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1482" x2="1482" y1="118.5625" y2="2124.1797"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="90.5645">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="113.8457">User-HBA</text><ellipse cx="116.5" cy="15" fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,23 L116.5,50 M103.5,31 L129.5,31 M116.5,50 L103.5,65 M116.5,50 L129.5,65 " fill="none" filter="url(#f1cqnep3rlh27r)" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="187" x="20" y="2141.7441">Akteur in der Rolle</text><text fill="#000000" font-family="Aapex" font-size="20" lengthAdjust="spacing" textLength="95" x="66" y="2165.0254">User-HBA</text><ellipse cx="116.5" cy="2179.7422" fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" rx="8" ry="8" style="stroke:#000000;stroke-width:2.0;"/><path d="M116.5,2187.7422 L116.5,2214.7422 M103.5,2195.7422 L129.5,2195.7422 M116.5,2214.7422 L103.5,2229.7422 M116.5,2214.7422 L129.5,2229.7422 " fill="none" filter="url(#f1cqnep3rlh27r)" style="stroke:#000000;stroke-width:2.0;"/><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="224" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="101.8457">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="224" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="198" x="232" y="2148.7441">TI-Messenger-Client</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="452" y="53"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="487" y="78.5645">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="486.5" y="101.8457">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="60.5625" style="stroke:#000000;stroke-width:1.5;" width="214" x="452" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="138" x="487" y="2148.7441">Authenticator</text><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="486.5" y="2172.0254">des IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="681" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="736" y="101.8457">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="681" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="104" x="736" y="2148.7441">IDP-Dienst</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="910" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="963" y="101.8457">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="910" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="108" x="963" y="2148.7441">FHIR-Proxy</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1138" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1181" y="101.8457">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1138" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="128" x="1181" y="2148.7441">Auth-Service</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373" y="76.2813"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1407.5" y="101.8457">FHIR-Directory</text><rect fill="#EFEFFF" filter="url(#f1cqnep3rlh27r)" height="37.2813" style="stroke:#000000;stroke-width:1.5;" width="214" x="1373" y="2123.1797"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="145" x="1407.5" y="2148.7441">FHIR-Directory</text><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="1731.1953" style="stroke:#000000;stroke-width:1.0;" width="10" x="328" y="317.9844"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="134.1563" style="stroke:#000000;stroke-width:1.0;" width="10" x="556" y="717.6328"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="717.6328"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="785" y="1022.9453"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1464.5078"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="167.9453" style="stroke:#000000;stroke-width:1.0;" width="10" x="1014" y="1815.4453"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="100.3672" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="515.8984"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="284.5234" style="stroke:#000000;stroke-width:1.0;" width="10" x="1242" y="944.3672"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1564.875"/><rect fill="#DCDCDC" filter="url(#f1cqnep3rlh27r)" height="33.7891" style="stroke:#000000;stroke-width:1.0;" width="10" x="1477" y="1915.8125"/><path d="M16,158.5625 L16,218.5625 L890,218.5625 L890,168.5625 L880,158.5625 L16,158.5625 " fill="#FBFB77" filter="url(#f1cqnep3rlh27r)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M880,158.5625 L880,168.5625 L890,168.5625 L880,158.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="139.5" y="175.6294"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="622" x="135.5" y="194.4751">Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="139.5" y="210.5513"/><polygon fill="#000000" points="316,313.9844,326,317.9844,316,321.9844,320,317.9844" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="322" y1="317.9844" y2="317.9844"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="168" x="123.5" y="272.397">FHIR Ressourcen im</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="123.5" y="292.186">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="123.5" y="311.9751">hinzufügen (MXID)</text><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="380" y1="391.3516" y2="391.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="380" x2="380" y1="391.3516" y2="404.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="339" x2="380" y1="404.3516" y2="404.3516"/><polygon fill="#000000" points="349,400.3516,339,404.3516,349,408.3516,345,404.3516" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="167" x="345" y="345.7642">Prüfung, ob gültiges</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="345" y="365.5532">owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="64" x="345" y="385.3423">vorliegt</text><path d="M10,444.3516 L74,444.3516 L74,451.3516 L64,461.3516 L10,461.3516 L10,444.3516 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="817.5391" style="stroke:#000000;stroke-width:2.0;" width="1472" x="10" y="444.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="457.4185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="89" y="462.3823">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="312" x="94" y="461.2031">kein gültigess owner-access-token</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="406" y="462.3823">]</text><polygon fill="#000000" points="1230,511.8984,1240,515.8984,1230,519.8984,1234,515.8984" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1236" y1="515.8984" y2="515.8984"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="345" y="509.8892">GET /owner-authenticate</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="569.4766" y2="569.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="569.4766" y2="582.4766"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="582.4766" y2="582.4766"/><polygon fill="#000000" points="1263,578.4766,1253,582.4766,1263,586.4766,1259,582.4766" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="164" x="1259" y="543.6782">Erzeuge PKCE Code</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="211" x="1259" y="563.4673">für verifier und challenge</text><polygon fill="#000000" points="349,612.2656,339,616.2656,349,620.2656,345,616.2656" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1246" y1="616.2656" y2="616.2656"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="424" x="816" y="610.2563">Redirct to IDP Authorization Endpoint (PKCE Code)</text><polygon fill="#000000" points="127.5,646.0547,117.5,650.0547,127.5,654.0547,123.5,650.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="121.5" x2="327" y1="650.0547" y2="650.0547"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="184" x="137" y="644.0454">Liste verfügbarer IDPs</text><polygon fill="#000000" points="316,679.8438,326,683.8438,316,687.8438,320,683.8438" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="116.5" x2="322" y1="683.8438" y2="683.8438"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="148" x="123.5" y="677.8345">ausgewählter IDP</text><polygon fill="#000000" points="773,713.6328,783,717.6328,773,721.6328,777,717.6328" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="779" y1="717.6328" y2="717.6328"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="345" y="711.6235">GET /authorize</text><polygon fill="#000000" points="349,747.4219,339,751.4219,349,755.4219,345,751.4219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="784" y1="751.4219" y2="751.4219"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="209" x="569" y="745.4126">Authentication challenge</text><line style="stroke:#000000;stroke-width:1.0;" x1="566" x2="608" y1="785.2109" y2="785.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="608" x2="608" y1="785.2109" y2="798.2109"/><line style="stroke:#000000;stroke-width:1.0;" x1="567" x2="608" y1="798.2109" y2="798.2109"/><polygon fill="#000000" points="577,794.2109,567,798.2109,577,802.2109,573,798.2109" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="573" y="779.2017">Authentication</text><polygon fill="#000000" points="773,847.7891,783,851.7891,773,855.7891,777,851.7891" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="561" x2="779" y1="851.7891" y2="851.7891"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="124" x="568" y="825.9907">Authentication</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="568" y="845.7798">challenge response</text><polygon fill="#000000" points="349,881.5781,339,885.5781,349,889.5781,345,885.5781" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="789" y1="885.5781" y2="885.5781"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="405" x="378" y="879.5688">Authorization Response with Authorization Code</text><polygon fill="#000000" points="1230,940.3672,1240,944.3672,1230,948.3672,1234,944.3672" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1236" y1="944.3672" y2="944.3672"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="526" x="345" y="938.3579">GET /owner-authenticate with Authorization code (PKCE Code)</text><polygon fill="#000000" points="806,1018.9453,796,1022.9453,806,1026.9453,802,1022.9453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="800" x2="1241" y1="1022.9453" y2="1022.9453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="178" x="1057" y="997.147">POST /tokenEndpoint</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="169" x="1066" y="1016.936">(authorization code)</text><polygon fill="#000000" points="1230,1052.7344,1240,1056.7344,1230,1060.7344,1234,1056.7344" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="790" x2="1236" y1="1056.7344" y2="1056.7344"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="72" x="797" y="1050.7251">id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="1090.5234" y2="1090.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="1090.5234" y2="1103.5234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="1103.5234" y2="1103.5234"/><polygon fill="#000000" points="1263,1099.5234,1253,1103.5234,1263,1107.5234,1259,1103.5234" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="121" x="1259" y="1084.5142">prüfe id_token</text><line style="stroke:#000000;stroke-width:1.0;" x1="1252" x2="1294" y1="1182.1016" y2="1182.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="1294" x2="1294" y1="1182.1016" y2="1195.1016"/><line style="stroke:#000000;stroke-width:1.0;" x1="1253" x2="1294" y1="1195.1016" y2="1195.1016"/><polygon fill="#000000" points="1263,1191.1016,1253,1195.1016,1263,1199.1016,1259,1195.1016" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="66" x="1259" y="1156.3032">erzeuge</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1259" y="1176.0923">owner-accesstoken</text><polygon fill="#000000" points="349,1224.8906,339,1228.8906,349,1232.8906,345,1228.8906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1246" y1="1228.8906" y2="1228.8906"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1081" y="1222.8813">owner-accesstoken</text><path d="M10,1300.8906 L297,1300.8906 L297,1310.8906 L287,1320.8906 L10,1320.8906 L10,1300.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="781.2891" style="stroke:#000000;stroke-width:2.0;" width="1601" x="10" y="1300.8906"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="242" x="25" y="1316.7422">VZD-FHIR-Directory Eintrag</text><path d="M214,1353.5156 L464,1353.5156 L464,1363.5156 L454,1373.5156 L214,1373.5156 L214,1353.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="311.9375" style="stroke:#000000;stroke-width:2.0;" width="1387" x="214" y="1353.5156"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="205" x="229" y="1369.3672">FHIR-Ressourcen lesen</text><polygon fill="#000000" points="1002,1460.5078,1012,1464.5078,1002,1468.5078,1006,1464.5078" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1008" y1="1464.5078" y2="1464.5078"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="278" x="345" y="1418.9204">POST /owner/PractitionerRole/?...</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="333" x="345" y="1438.7095">Finde Datensatz für eigene TelematikID</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="345" y="1458.4985">Authorization Bearer owner-accesstoken</text><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1066" y1="1518.0859" y2="1518.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="1066" x2="1066" y1="1518.0859" y2="1531.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="1025" x2="1066" y1="1531.0859" y2="1531.0859"/><polygon fill="#000000" points="1035,1527.0859,1025,1531.0859,1035,1535.0859,1031,1531.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1031" y="1492.2876">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1031" y="1512.0767">owner-accesstoken</text><polygon fill="#000000" points="1465,1560.875,1475,1564.875,1465,1568.875,1469,1564.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1471" y1="1564.875" y2="1564.875"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1031" y="1558.8657">HTTPS Forward</text><polygon fill="#000000" points="1035,1594.6641,1025,1598.6641,1035,1602.6641,1031,1598.6641" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1029" x2="1481" y1="1598.6641" y2="1598.6641"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1343" y="1592.6548">result body json</text><polygon fill="#000000" points="349,1628.4531,339,1632.4531,349,1636.4531,345,1632.4531" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1018" y1="1632.4531" y2="1632.4531"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="880" y="1626.4438">result body json</text><path d="M214,1704.4531 L504,1704.4531 L504,1714.4531 L494,1724.4531 L214,1724.4531 L214,1704.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="311.9375" style="stroke:#000000;stroke-width:2.0;" width="1387" x="214" y="1704.4531"/><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="245" x="229" y="1720.3047">FHIR-Ressourcen schreiben</text><polygon fill="#000000" points="1002,1811.4453,1012,1815.4453,1002,1819.4453,1006,1815.4453" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="338" x2="1008" y1="1815.4453" y2="1815.4453"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="459" x="345" y="1769.8579">FHIR-Operationen um eigenen Datensatz zu verwalten</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="338" x="345" y="1789.647">Authorization Bearer owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="314" x="345" y="1809.436">(Optional: setze Flag für Sichtbarkeit)</text><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1066" y1="1869.0234" y2="1869.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1066" x2="1066" y1="1869.0234" y2="1882.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="1025" x2="1066" y1="1882.0234" y2="1882.0234"/><polygon fill="#000000" points="1035,1878.0234,1025,1882.0234,1035,1886.0234,1031,1882.0234" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="44" x="1031" y="1843.2251">prüfe</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="159" x="1031" y="1863.0142">owner-accesstoken</text><polygon fill="#000000" points="1465,1911.8125,1475,1915.8125,1465,1919.8125,1469,1915.8125" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1024" x2="1471" y1="1915.8125" y2="1915.8125"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="128" x="1031" y="1909.8032">HTTPS Forward</text><polygon fill="#000000" points="1035,1945.6016,1025,1949.6016,1035,1953.6016,1031,1949.6016" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1029" x2="1481" y1="1949.6016" y2="1949.6016"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="1343" y="1943.5923">result body json</text><polygon fill="#000000" points="349,1979.3906,339,1983.3906,349,1987.3906,345,1983.3906" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="343" x2="1018" y1="1983.3906" y2="1983.3906"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="132" x="880" y="1977.3813">result body json</text><polygon fill="#000000" points="127.5,2045.1797,117.5,2049.1797,127.5,2053.1797,123.5,2049.1797" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="121.5" x2="332" y1="2049.1797" y2="2049.1797"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="54" x="272" y="2043.1704">Status</text><!--MD5=[5da475788f41ad5bf20156782e93916c]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}
    actor U as "Akteur in der Rolle\nUser-HBA"
    box <size:18>Endgerät</size> #WhiteSmoke
      participant C as "TI-Messenger-Client"
      participant A as "Authenticator \ndes IDP-Dienst"
    end box
    participant I as "IDP-Dienst" 
    box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
      participant FP as "FHIR-Proxy"
      participant Auth as "Auth-Service"
      participant VZD as "FHIR-Directory"
    end box

|||
note over U, I: \n<size:17>Der Akteur ist bei einem Messenger Service angemeldet (siehe AF_10057)</size>\n
|||

U->C: FHIR Ressourcen im \nVZD-FHIR-Directory \nhinzufügen (MXID)
  Activate C
C->C: Prüfung, ob gültiges \nowner-accesstoken \nvorliegt

|||
alt#LightGrey #AliceBlue <size:16>kein gültigess owner-access-token</size>
|||

  C->Auth: GET /owner-authenticate
    Activate Auth
  Auth->Auth: Erzeuge PKCE Code \nfür verifier und challenge
  Auth- ->C: Redirct to IDP Authorization Endpoint (PKCE Code)
    Deactivate Auth

  C->U: Liste verfügbarer IDPs
  U->C: ausgewählter IDP
    
  C->I: GET /authorize
    Activate A
    Activate I
  I- ->C: Authentication challenge
  A->A: Authentication
  A->I: Authentication \nchallenge response
    Deactivate A
  I- ->C: Authorization Response with Authorization Code
    Deactivate I
       
  |||          
  C->Auth: GET /owner-authenticate with Authorization code (PKCE Code)
    Activate Auth
  |||
  Auth- ->I: POST /tokenEndpoint\n(authorization code)
    Activate I
  I->Auth: id_token
    Deactivate I
  Auth->Auth: prüfe id_token
  |||
  Auth->Auth: erzeuge \nowner-accesstoken
  Auth- ->C: owner-accesstoken
    Deactivate Auth
  |||
end
      
|||

group <size:16>VZD-FHIR-Directory Eintrag</size>
  |||
  group <size:16>FHIR-Ressourcen lesen</size>
  |||
  C->FP: POST /owner/PractitionerRole/?... \nFinde Datensatz für eigene TelematikID \nAuthorization Bearer owner-accesstoken
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
  |||
  end
    
  |||
  group <size:16>FHIR-Ressourcen schreiben</size>
  |||
  C->FP: FHIR-Operationen um eigenen Datensatz zu verwalten \nAuthorization Bearer owner-accesstoken \n(Optional: setze Flag für Sichtbarkeit)
    Activate FP
  FP->FP: prüfe \nowner-accesstoken
  FP->VZD: HTTPS Forward
    Activate VZD
  VZD- ->FP: result body json
    Deactivate VZD
  FP- ->C: result body json
    Deactivate FP
     
  |||
  end

  C- ->U: Status    
    Deactivate C
  |||
end
|||

  Deactivate C
@enduml

PlantUML version 1.2021.16(Wed Dec 08 17:25:22 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>