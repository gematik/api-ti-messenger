<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1528px" preserveAspectRatio="none" style="width:1145px;height:1528px;background:#FFFFFF;" version="1.1" viewBox="0 0 1145 1528" width="1145px" zoomAndPan="magnify"><defs/><g><rect fill="#F5F5F5" height="1516.7109" style="stroke:#181818;stroke-width:0.5;" width="510" x="502" y="6"/><text fill="#000000" font-family="sans-serif" font-size="18" font-weight="bold" lengthAdjust="spacing" textLength="171" x="669.5" y="24.6855">VZD-FHIR-Directory</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="4" x="840.5" y="25.7842"> </text><rect fill="#DCDCDC" height="1389.2813" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="82.0352"/><rect fill="#DCDCDC" height="46.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="137" y="1303.5508"/><rect fill="#DCDCDC" height="153.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="608" y="473.1992"/><rect fill="#DCDCDC" height="523.2891" style="stroke:#000000;stroke-width:1.0;" width="10" x="608" y="736.8789"/><rect fill="#DCDCDC" height="174.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="896" y="213.1367"/><rect fill="none" height="545.6953" style="stroke:#000000;stroke-width:1.5;" width="1129" x="10" y="89.0352"/><rect fill="none" height="276.5391" style="stroke:#000000;stroke-width:1.5;" width="1109" x="20" y="119.5117"/><rect fill="#FFB6C1" height="123.0078" style="stroke:#000000;stroke-width:1.5;" width="710" x="20" y="800.2617"/><rect fill="none" height="359.8984" style="stroke:#000000;stroke-width:1.5;" width="710" x="20" y="1078.418"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="137" x2="137" y1="72.0352" y2="1480.3164"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="613" x2="613" y1="72.0352" y2="1480.3164"/><line style="stroke:#000000;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="901" x2="901" y1="72.0352" y2="1480.3164"/><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="32.6406"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="176" x="49" y="59.8164">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="30" y="1479.3164"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="176" x="49" y="1506.4922">Registrierungs-Dienst</text><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="506" y="32.6406"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="87" x="569.5" y="59.8164">FHIR-Proxy</text><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="506" y="1479.3164"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="87" x="569.5" y="1506.4922">FHIR-Proxy</text><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="794" y="32.6406"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="114" x="844" y="59.8164">OAuth-Service</text><rect fill="#EFEFFF" height="38.3945" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="214" x="794" y="1479.3164"/><text fill="#000000" font-family="Impact" font-size="20" lengthAdjust="spacing" textLength="114" x="844" y="1506.4922">OAuth-Service</text><rect fill="#DCDCDC" height="1389.2813" style="stroke:#000000;stroke-width:1.0;" width="10" x="132" y="82.0352"/><rect fill="#DCDCDC" height="46.3828" style="stroke:#000000;stroke-width:1.0;" width="10" x="137" y="1303.5508"/><rect fill="#DCDCDC" height="153.5313" style="stroke:#000000;stroke-width:1.0;" width="10" x="608" y="473.1992"/><rect fill="#DCDCDC" height="523.2891" style="stroke:#000000;stroke-width:1.0;" width="10" x="608" y="736.8789"/><rect fill="#DCDCDC" height="174.9141" style="stroke:#000000;stroke-width:1.0;" width="10" x="896" y="213.1367"/><path d="M10,89.0352 L71,89.0352 L71,97.3867 L61,107.3867 L10,107.3867 L10,89.0352 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="545.6953" style="stroke:#000000;stroke-width:1.5;" width="1129" x="10" y="89.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="25" y="103.5303">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="86" y="108.7432">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="354" x="90" y="107.6445">kein gültiges provider-accesstoken vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="444" y="108.7432">]</text><path d="M20,119.5117 L81,119.5117 L81,127.8633 L71,137.8633 L20,137.8633 L20,119.5117 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="276.5391" style="stroke:#000000;stroke-width:1.5;" width="1109" x="20" y="119.5117"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="134.0068">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="96" y="139.2197">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="289" x="100" y="138.1211">Benötigt IDP-TI-Provider-Accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="389" y="139.2197">]</text><polygon fill="#000000" points="884,209.1367,894,213.1367,884,217.1367,888,213.1367" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="890" y1="213.1367" y2="213.1367"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="256" x="149" y="164.6357">GET /token(client-ID, client_secret)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="160" x="149" y="186.0186">für Realm "ti-provider"</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="149" y="207.4014">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="906" x2="948" y1="269.9023" y2="269.9023"/><line style="stroke:#000000;stroke-width:1.0;" x1="948" x2="948" y1="269.9023" y2="282.9023"/><line style="stroke:#000000;stroke-width:1.0;" x1="907" x2="948" y1="282.9023" y2="282.9023"/><polygon fill="#000000" points="917,278.9023,907,282.9023,917,286.9023,913,282.9023" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="134" x="913" y="242.7842">Credentials prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="175" x="913" y="264.167">(client-ID, client_secret)</text><line style="stroke:#000000;stroke-width:1.0;" x1="906" x2="948" y1="339.668" y2="339.668"/><line style="stroke:#000000;stroke-width:1.0;" x1="948" x2="948" y1="339.668" y2="352.668"/><line style="stroke:#000000;stroke-width:1.0;" x1="907" x2="948" y1="352.668" y2="352.668"/><polygon fill="#000000" points="917,348.668,907,352.668,917,356.668,913,352.668" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="214" x="913" y="312.5498">IDP-TI-Provider-Accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="60" x="913" y="333.9326">erstellen</text><path d="M583,310.7227 L583,340.7227 L891,340.7227 L891,320.7227 L881,310.7227 L583,310.7227 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M881,310.7227 L881,320.7227 L891,320.7227 L881,310.7227 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="16" lengthAdjust="spacing" textLength="287" x="589" y="332.332">Payload beinhaltet ClientID + TelematikID</text><polygon fill="#000000" points="153,384.0508,143,388.0508,153,392.0508,149,388.0508" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="900" y1="388.0508" y2="388.0508"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="214" x="680" y="382.3154">IDP-TI-Provider-Accesstoken</text><polygon fill="#000000" points="596,469.1992,606,473.1992,596,477.1992,600,473.1992" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="602" y1="473.1992" y2="473.1992"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="209" x="149" y="424.6982">GET /ti-provider-authenticate</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="226" x="149" y="446.0811">(IDP-TI-Provider-Accesstoken)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="149" y="467.4639">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="618" x2="660" y1="529.9648" y2="529.9648"/><line style="stroke:#000000;stroke-width:1.0;" x1="660" x2="660" y1="529.9648" y2="542.9648"/><line style="stroke:#000000;stroke-width:1.0;" x1="619" x2="660" y1="542.9648" y2="542.9648"/><polygon fill="#000000" points="629,538.9648,619,542.9648,629,546.9648,625,542.9648" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="260" x="625" y="502.8467">Token prüfen und ClientID auslesen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="226" x="625" y="524.2295">(IDP-TI-Provider-Accesstoken)</text><line style="stroke:#000000;stroke-width:1.0;" x1="618" x2="660" y1="578.3477" y2="578.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="660" x2="660" y1="578.3477" y2="591.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="619" x2="660" y1="591.3477" y2="591.3477"/><polygon fill="#000000" points="629,587.3477,619,591.3477,629,595.3477,625,591.3477" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="229" x="625" y="572.6123">provider-accesstoken erzeugen</text><polygon fill="#000000" points="153,622.7305,143,626.7305,153,630.7305,149,626.7305" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="612" y1="626.7305" y2="626.7305"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="156" x="450" y="620.9951">provider-accesstoken</text><polygon fill="#000000" points="596,732.8789,606,736.8789,596,740.8789,600,736.8789" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="602" y1="736.8789" y2="736.8789"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="432" x="149" y="688.3779">GET /tim-provider-services/FederationList/federationList.jws</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="285" x="149" y="709.7607">(provider-accesstoken, FLVersion_RD)</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="259" x="149" y="731.1436">{&lt;10s := HealthState_VZD=gesund}</text><line style="stroke:#000000;stroke-width:1.0;" x1="618" x2="660" y1="772.2617" y2="772.2617"/><line style="stroke:#000000;stroke-width:1.0;" x1="660" x2="660" y1="772.2617" y2="785.2617"/><line style="stroke:#000000;stroke-width:1.0;" x1="619" x2="660" y1="785.2617" y2="785.2617"/><polygon fill="#000000" points="629,781.2617,619,785.2617,629,789.2617,625,785.2617" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="264" x="625" y="766.5264">Token prüfen(provider-accesstoken)</text><path d="M20,800.2617 L101,800.2617 L101,808.6133 L91,818.6133 L20,818.6133 L20,800.2617 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="123.0078" style="stroke:#000000;stroke-width:1.5;" width="710" x="20" y="800.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="36" x="35" y="814.7568">break</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="116" y="819.9697">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="305" x="120" y="818.8711">Abruf der Föderationsliste nicht möglich</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="425" y="819.9697">]</text><polygon fill="#000000" points="153,911.2695,143,915.2695,153,919.2695,149,915.2695" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="607" y1="915.2695" y2="915.2695"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="262" x="331" y="845.3857">ResponseType=Bad Request ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="265" x="331" y="866.7686">ResponseType=Unauthorized ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="243" x="331" y="888.1514">ResponseType=Forbidden ODER</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="193" x="331" y="909.5342">ResponseType=Not Found</text><line style="stroke:#000000;stroke-width:1.0;" x1="618" x2="660" y1="1025.418" y2="1025.418"/><line style="stroke:#000000;stroke-width:1.0;" x1="660" x2="660" y1="1025.418" y2="1038.418"/><line style="stroke:#000000;stroke-width:1.0;" x1="619" x2="660" y1="1038.418" y2="1038.418"/><polygon fill="#000000" points="629,1034.418,619,1038.418,629,1042.418,625,1038.418" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="171" x="625" y="976.917">Auf neuere Version der</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="166" x="625" y="998.2998">Föderationsliste prüfen</text><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="119" x="625" y="1019.6826">(FLVersion_RD)</text><path d="M20,1078.418 L81,1078.418 L81,1086.7695 L71,1096.7695 L20,1096.7695 L20,1078.418 " fill="#D3D3D3" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="359.8984" style="stroke:#000000;stroke-width:1.5;" width="710" x="20" y="1078.418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="35" y="1092.9131">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="96" y="1098.126">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="404" x="100" y="1097.0273">keine neuere Version der Föderationsliste vorhanden</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="504" y="1098.126">]</text><polygon fill="#000000" points="153,1125.2773,143,1129.2773,153,1133.2773,149,1129.2773" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="607" y1="1129.2773" y2="1129.2773"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="199" x="402" y="1123.542">ResponseType=No Content</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1164.6602" y2="1164.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1164.6602" y2="1177.6602"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1177.6602" y2="1177.6602"/><polygon fill="#000000" points="153,1173.6602,143,1177.6602,153,1181.6602,149,1177.6602" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="452" x="149" y="1158.9248">Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="730" y1="1211.6602" y2="1211.6602"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="25" y="1229.3682">[</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="579" x="29" y="1228.2695">neuere Version der Föderationsliste vorhanden ODER FLVersion_RD=NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="608" y="1229.3682">]</text><polygon fill="#000000" points="153,1256.168,143,1260.168,153,1264.168,149,1260.168" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="612" y1="1260.168" y2="1260.168"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="253" x="353" y="1254.4326">Föderationsliste, x5c-Zertifikatsliste</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="189" y1="1290.5508" y2="1290.5508"/><line style="stroke:#000000;stroke-width:1.0;" x1="189" x2="189" y1="1290.5508" y2="1303.5508"/><line style="stroke:#000000;stroke-width:1.0;" x1="148" x2="189" y1="1303.5508" y2="1303.5508"/><polygon fill="#000000" points="158,1299.5508,148,1303.5508,158,1307.5508,154,1303.5508" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="336" x="154" y="1284.8154">Föderationsliste aktualisieren(Föderationsliste)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="147" x2="189" y1="1348.9336" y2="1348.9336"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="189" x2="189" y1="1348.9336" y2="1361.9336"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="142" x2="189" y1="1361.9336" y2="1361.9336"/><polygon fill="#000000" points="152,1357.9336,142,1361.9336,152,1365.9336,148,1361.9336" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="253" x="154" y="1343.1982">Föderationsliste, FLÄnderungsFlag</text><line style="stroke:#000000;stroke-width:1.0;" x1="142" x2="184" y1="1392.3164" y2="1392.3164"/><line style="stroke:#000000;stroke-width:1.0;" x1="184" x2="184" y1="1392.3164" y2="1405.3164"/><line style="stroke:#000000;stroke-width:1.0;" x1="143" x2="184" y1="1405.3164" y2="1405.3164"/><polygon fill="#000000" points="153,1401.3164,143,1405.3164,153,1409.3164,149,1405.3164" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="17" lengthAdjust="spacing" textLength="452" x="149" y="1386.5811">Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)</text><!--MD5=[b69822d1e2f3340eb997519255fc1c85]
@startuml
skinparam sequenceMessageAlign direction
skinparam minClassWidth 200
skinparam BoxPadding 1
skinparam sequenceReferenceHeaderBackgroundColor palegreen
scale max 2048 width

skinparam sequence {
ArrowColor black
ArrowFontSize 17
ActorBorderColor black
LifeLineBorderColor black
LifeLineBackgroundColor Gainsboro

ParticipantBorderColor Motivation
ParticipantBackgroundColor Motivation
ParticipantFontName Impact
ParticipantFontSize 20
ParticipantFontColor black
ParticipantBorderColor Black
ParticipantBackgroundColor MOTIVATION

ActorBackgroundColor Gainsboro
ActorFontColor black
ActorFontSize 20
ActorFontName Aapex
}

participant RD as "Registrierungs-Dienst"
box <size:18>VZD-FHIR-Directory</size> #WhiteSmoke
  participant FP as "FHIR-Proxy"
  participant AS as "OAuth-Service"
end box

alt#LightGrey <size:16>kein gültiges provider-accesstoken vorhanden</size>
  activate RD
  alt#LightGrey <size:16>Benötigt IDP-TI-Provider-Accesstoken</size>
      RD -> AS: GET /token(client-ID, client_secret)\nfür Realm "ti-provider"\n{<10s := HealthState_VZD=gesund}
      activate AS
      AS -> AS: Credentials prüfen \n(client-ID, client_secret)
      AS -> AS: IDP-TI-Provider-Accesstoken\nerstellen
      note left: <size:16>Payload beinhaltet ClientID + TelematikID</size>
      AS - -> RD: IDP-TI-Provider-Accesstoken
      deactivate AS
  end
  RD -> FP: GET /ti-provider-authenticate\n(IDP-TI-Provider-Accesstoken)\n{<10s := HealthState_VZD=gesund}
  activate FP
  FP -> FP: Token prüfen und ClientID auslesen\n(IDP-TI-Provider-Accesstoken)
  FP -> FP: provider-accesstoken erzeugen
  FP - -> RD: provider-accesstoken
  deactivate FP
end

|||
RD->FP: GET /tim-provider-services/FederationList/federationList.jws\n(provider-accesstoken, FLVersion_RD)\n{<10s := HealthState_VZD=gesund}
  Activate FP
FP->FP: Token prüfen(provider-accesstoken)

break#LightGrey #LightPink <size:16>Abruf der Föderationsliste nicht möglich</size>
  FP- ->RD: ResponseType=Bad Request ODER \nResponseType=Unauthorized ODER \nResponseType=Forbidden ODER \nResponseType=Not Found
end 

|||
FP->FP: Auf neuere Version der \nFöderationsliste prüfen\n(FLVersion_RD)
|||

alt#LightGrey <size:16>keine neuere Version der Föderationsliste vorhanden</size>
  FP- ->RD: ResponseType=No Content
  RD->RD: Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)
  |||
else <size:16>neuere Version der Föderationsliste vorhanden ODER FLVersion_RD=NULL</size>
  FP- ->RD: Föderationsliste, x5c-Zertifikatsliste
      Deactivate FP
  RD->RD++: Föderationsliste aktualisieren(Föderationsliste)
  return Föderationsliste, FLÄnderungsFlag
  RD->RD: Alter_Föderationsliste zurücksetzen(Alter_Föderationsliste=0s)
  |||
end
|||


@enduml

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: de
Country: DE
--></g></svg>