ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:source-style: listing
endif::[]

ifndef::env-github[:source-style: source]

:imagesdir: ./images/

image::meta/gematik.png[logo,width=250,height=47,role=right]

= TI-Messenger

Ã–ffentlicher Matrixraum: https://matrix.to/#/#tim-spec:matrix.org

image:https://github.com/gematik/api-ti-messenger/actions/workflows/lint.yml/badge.svg[link="https://github.com/gematik/api-ti-messenger/actions/workflows/lint.yml"]
image:https://github.com/gematik/api-ti-messenger/actions/workflows/generate-images.yml/badge.svg[link="https://github.com/gematik/api-ti-messenger/actions/workflows/generate-images.yml"]

image:https://img.shields.io/badge/Release%20Notes-tim&hyphen;pro&hyphen;1.0.0-red?style=plastic&logo=github&logoColor=red[link="ReleaseNotes.md"] +
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;Basis-latest-green?style=plastic&logo=github&logoColor=green[link="https://gemspec.gematik.de/docs/gemSpec/gemSpec_TI-M_Basis/latest/"]
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;ePA-latest-green?style=plastic&logo=github&logoColor=green[link="https://gemspec.gematik.de/docs/gemSpec/gemSpec_TI-M_ePA/latest/"]
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;Pro-latest-green?style=plastic&logo=github&logoColor=green[link="https://gemspec.gematik.de/docs/gemSpec/gemSpec_TI-M_Pro/latest/"] +
image:https://img.shields.io/badge/Matrix_Client_Server_API-v1.11-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.11/client-server-api/"]
image:https://img.shields.io/badge/Matrix_Server_Server_API-v1.11-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.11/server-server-api/"]
image:https://img.shields.io/badge/Matrix_Push_Gateway_API-v1.11-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.11/push-gateway-api/"]

== Ãœberblick
Die folgende Dokumentation ergÃ¤nzt die Spezifikationen *TI-Messenger ePA* und *TI-Messenger Pro*. An dieser Stelle werden insbesondere die in der Spezifikation genannten Komponenten der LÃ¶sung sowie deren Schnittstellen weiter dargestellt und erlÃ¤utert, um Hersteller und Anbieter bestmÃ¶glich zu unterstÃ¼tzen.

== Branches
FÃ¼r die Dokumentation des *TI-Messenger-Dienstes* werden in GitHub die folgenden Branches verwendet:

- `main`: enthÃ¤lt die Dokumentation fÃ¼r das aktuell verÃ¶ffentlichte Release
- `develop`: enthÃ¤lt die Dokumentation der in Entwicklung befindlichen Features, die noch nicht released sind, 
- `hotfix`: enthÃ¤lt die Dokumentation kurzfristig notwendiger Ã„nderungen am aktuellen Release, 
- `feature/*`: enthÃ¤lt eine Vorschau, Vorbereitungen und Diskussion eines neuen Themas, welches noch nicht in der Entwicklung ist. Die Inhalte kÃ¶nnen unvollstÃ¤ndig sein und sich bis zur Fertigstellung noch Ã¤ndern.

== SystemÃ¼bersicht
Die folgende Abbildung gibt einen Ãœberblick Ã¼ber die Systemarchitektur des TI-Messengers insbesondere auf die Schnittstellen zwischen den Komponenten, die in den folgenden Kapiteln weiter betrachtet werden.

image::System_overview.png[width="100%"]

TIP: Auf die Schnittstellen zur Autentisierung am *Auth-Service* des *VZD-FHIR-Directory* wird in der oben gezeigten Abbildung verzichtet. Die Informationen hierzu kÃ¶nnen in dem entsprechenden Kapitel fÃ¼r das *VZD-FHIR-Directory* link:https://github.com/gematik/api-vzd/blob/gemILF_VZD_FHIR_Directory/1.2.2/docs/FHIR_VZD_HOWTO_Authenticate.adoc#fhirdirectoryauthenticationapis[hier] nachgelesen werden.

link:docs/Fachdienst/Fachdienst.adoc[*TI Messenger-Fachdienst*]

* link:docs/Fachdienst/Registrierungsdienst.adoc[*Registrierungs-Dienst*] +
Der *Registrierungs-Dienst* bietet drei abstrakte Schnittstellen an. Die Schnittstelle `I_Registration` wird vom *Frontend des Registrierungs-Dienstes* aufgerufen, um eine Organisation beim *Registrierungs-Dienst* zu authentifizieren und *Messenger-Services* zu administrieren. Die Schnittstelle `I_internVerification` wird von den *Messenger-Proxies* aufgerufen, um die FÃ¶derationsliste abzurufen und dient zusÃ¤tzlich der PrÃ¼fung (der beteiligten Akteure) auf existierende VZD-FHIR-EintrÃ¤ge. Die Schnittstelle `I_requestToken` wird vom *Org-Admin-Client* aufgerufen, um Zugang zum *FHIR-Proxy* fÃ¼r die Bearbeitung von FHIR-Ressourcen zu erhalten.

* link:docs/Fachdienst/MessengerService.adoc[*Messenger-Service*] +
Ein *Messenger-Service* besteht aus den Teilkomponenten *Messenger-Proxy* und einem *Matrix-Homeserver*. Die Teilkomponente *Matrix-Homeserver* basiert auf dem offenen Kommunikationsprotokoll Matrix und bietet die `Matrix-Client-Server API` sowie die `Matrix-Server-Server API` an. Die Kommunikation zu einem *Matrix-Homeserver* wird immer Ã¼ber den *Messenger-Proxy* geleitet, sofern die BerechtigungsprÃ¼fung erfolgreich war. Der *Messenger-Proxy* stellt die Schnittstelle `I_TiMessengerContactManagement` bereit, um die Administration der Freigabeliste eines Akteurs zu ermÃ¶glichen. 

* https://spec.matrix.org/v1.3/push-gateway-api/[*Push-Gateway*] +
Das *Push-Gateway* stellt die `Matrix-Push-Gateway API` gemÃ¤ÃŸ der Matrix Spezifikation bereit. Dieses ermÃ¶glicht die Weiterleitung von Benachrichtigungen an Akteure des *TI-Messenger-Dienstes*.

link:docs/Client/Client.adoc[*TI Messenger-Client*] +

* Der *TI-Messenger-Client* basiert auf der `Matrix-Client-Server API`. Er wird durch weitere Funktionsmerkmale erweitert und ruft die Schnittstellen am *TI-Messenger-Fachdienst* sowie am *VZD-FHIR-Directory* auf.

link:https://github.com/gematik/api-vzd/blob/main/docs/Fachkonzept_FHIR-Directory.adoc[*VZD-FHIR-Directory*] +

* Beim *VZD-FHIR-Directory* handelt es sich um einen zentralen Verzeichnisdient der TI, der die deutschlandweite Suche von Organisationen und Akteuren des *TI-Messenger-Dienstes* ermÃ¶glicht. Das *VZD-FHIR-Directory* basiert auf dem FHIR-Standard und bietet neben der Suche (`FHIRDirectorySearchAPI`) fÃ¼r den *TI-Messenger-Dienst* Schnittstellen zur Administration der link:docs/Foederationsliste/Foederationsliste.adoc[*FÃ¶derationsliste*] an (`FHIRDirectoryTIMProviderAPI`). ZusÃ¤tzlich existiert fÃ¼r Organisaitonen und Practitioner eine Schnittstelle (`FHIRDirectoryOwnerAPI`), Ã¼ber die die Verwaltung des eigenen Eintrages im *VZD-FHIR-Directory* mÃ¶glich ist. Details sind dem link:https://github.com/gematik/api-vzd/blob/gemILF_VZD_FHIR_Directory/1.2.2/docs/gemILF_VZD_FHIR_Directory.adoc[*Implementierungsleitfaden*] des *VZD-FHIR-Directory* zu entnehmen.

link:docs/IDP/idp.adoc[*Zentraler IDP-Dienst*] +

* Der *Zentrale IDP-Dienst* der gematik Ã¼bernimmt die Aufgabe der smartcard-basierten Authentisierung eines Akteures. Hierbei fasst der *IDP-Dienst* aus der Smartcard notwendige Attribute (z. B. `TelematikID`, `ProfessionOID`) in ein signiertes JSON Web Token (`ID_TOKEN`) zusammen, damit sich ein Client gegenÃ¼ber Fachanwendungen (*Registrierungs-Dienst* und *VZD-FHIR-Directory*) identifizieren kann. 

link:docs/Authenticator/authenticator.adoc[*gematik Authenticator*] +

* Der *Authenticator* der gematik erhÃ¤lt vom *zentralen IDP-Dienst* einen `AUTHORIZATION_CODE` zurÃ¼ck, welcher durch Vorlage vom *Registrierungs-Dienst* oder vom *Auth-Service* des *VZD-FHIR-Directory* am *IDP-Dienst* durch ein `ID_TOKEN` ausgetauscht wird.

== Ordnerstruktur
Im Folgenden sind die wesentlichen Inhalte des Repositories dargestellt.

[{source-style},subs="macros"]
----
TI-Messenger Dokumentation
â”œâ”€ link:docs[docs] (weiterfÃ¼hrende Informationen)
|   â”œâ”€â”€â”€â”€ link:docs/Authenticator[Authenticator]
|   â”œâ”€â”€â”€â”€ link:docs/Client[Client]
|   â”œâ”€â”€â”€â”€ link:docs/Foederationsliste[FÃ¶derationsliste]
|   â”œâ”€â”€â”€â”€ link:docs/Fachdienst[Fachdienst]
|   â”œâ”€â”€â”€â”€ link:docs/IDP[IDP]
|   â”œâ”€â”€â”€â”€ link:docs/Primaersystem[Primaersystem]
|   â”œâ”€â”€â”€â”€ link:docs/anwendungsfaelle[AnwendungsfÃ¤lle]
|   â”œâ”€â”€â”€â”€ link:docs/anwendungsfaelle/COM-chatbot.adoc[Chatbot]
|   â”œâ”€â”€â”€â”€ link:docs/Test/Test.adoc[Testkonzept]
|   â””â”€â”€â”€â”€ link:docs/FAQ[FAQ]
â”œâ”€ link:images[images] (Bildarchiv)
â”‚   â””â”€â”€â”€â”€ link:images/generated[generated] (draw.io & PlantUML gerenderte Bilder)
â”œâ”€ link:samples[samples] (Codebeispiele, Postman Collections, etc)
â”œâ”€ link:src[src] (Quellen)
â”‚   â”œâ”€â”€â”€â”€ link:src/images[images] (Quellen der draw.io- und PlantUML-Diagramme)
â”‚   â””â”€â”€â”€â”€ link:src/openapi[openapi] (Schnittstellenbeschreibungen)
â”‚        â”œâ”€â”€ link:src/openapi/TiMessengerContactManagement.yaml[TiMessengerContactManagement.yaml] (API-Beschreibung der Freigabeliste)
â”‚        â””â”€â”€ link:src/openapi/TiMessengerTestTreiber.yaml[TiMessengerTestTreiber.yaml] (API-Beschreibung der TestTreiber-Schnittstelle)
â”œâ”€â”€ link:README.adoc[README.adoc]
â”œâ”€â”€ link:CODE_OF_CONDUCT.md[CODE_OF_CONDUCT.md]
â”œâ”€â”€ link:CONTRIBUTING.md[CONTRIBUTING.md]
â”œâ”€â”€ link:LICENSE.md[LICENSE.md]
â”œâ”€â”€ link:Pull_request_template.md[Pull_request_template.md]
â”œâ”€â”€ link:SECURITY.md[SECURITY.md]
â””â”€â”€ link:ReleaseNotes.md[ReleaseNotes.md]
----

== ðŸ’¡ Onboarding
Hersteller und Anbieter eines TI-Messengers kÃ¶nnen das von der gematik im https://fachportal.gematik.de/anwendungen/ti-messenger[Fachportal] bereitgestellte Welcome Package zum Onboarding nutzen. Dieses Welcome Package ist als "Schritt-fÃ¼r-Schritt"-Anleitung gedacht, um Hersteller und Anbieter beim Onboarding des *TI-Messenger-Dienstes* zu unterstÃ¼tzen.

== WeiterfÃ¼hrende Seiten
*Produkttypen* +
link:docs/Fachdienst/Fachdienst.adoc[- TI-Messenger-Fachdienst] +
link:docs/Client/Client.adoc[- TI-Messenger-Client] +
link:https://github.com/gematik/api-vzd/blob/main/docs/Fachkonzept_FHIR-Directory.adoc[- VZD-FHIR-Directory] +
link:docs/IDP/idp.adoc[- Zentraler IDP-Dienst] +

*Nutzung des TI-Messenger-Clients: Automatisierung und Schnittstellenintegration* +
link:docs/Client/Automatisierung.adoc[- Automatisierung und Schnittstellenintegration] +

*Leitfaden fÃ¼r PrimÃ¤rsystemhersteller* +
link:docs/Primaersystem/Primaersystem.adoc[- PrimÃ¤rsystem] +

*Diverses* +
https://fachportal.gematik.de/anwendungen/ti-messenger[- TI-Messenger im gematik Fachportal]
https://fachportal.gematik.de/hersteller-anbieter/komponenten-dienste/authenticator[- Authenticator im gematik Fachportal] +
https://github.com/gematik/TI-Messenger-Testsuite[- TI-Messenger-Testsuite] +
link:docs/FAQ/FAQ.adoc[- Fragen und Antworten zur aktuellen Spezifikation &#91;FAQ&#93;]

*Referenz-Implementierungen* +
- [comming soon]

== Lizenzbedingungen

Copyright 2023 gematik GmbH

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.

See the link:./LICENSE.md[LICENSE] for the specific language governing permissions and limitations under the License.

Unless required by applicable law the software is provided "as is" without warranty of any kind, either express or implied, including, but not limited to, the warranties of fitness for a particular purpose, merchantability, and/or non-infringement. The authors or copyright holders shall not be liable in any manner whatsoever for any damages or other claims arising from, out of or in connection with the software or the use or other dealings with the software, whether in an action of contract, tort, or otherwise.

The software is the result of research and development activities, therefore not necessarily quality assured and without the character of a liable product. For this reason, gematik does not provide any support or other user assistance (unless otherwise stated in individual cases and without justification of a legal obligation). Furthermore, there is no claim to further development and adaptation of the results to a more current state of the art.

Gematik may remove published results temporarily or permanently from the place of publication at any time without prior notice or justification.
