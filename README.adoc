ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:source-style: listing
endif::[]

ifndef::env-github[:source-style: source]

:imagesdir: ./images/
= TI Messenger Documentation v1.1.1

image::meta/gematik_logo.svg[gematik,width="70%"]

image:https://github.com/gematik/api-ti-messenger/actions/workflows/lint.yml/badge.svg?branch=tim-epa-fdv[link="https://github.com/gematik/api-ti-messenger/actions/workflows/lint.yml"]
image:https://github.com/gematik/api-ti-messenger/actions/workflows/generate-images.yml/badge.svg?branch=tim-epa-fdv[link="https://github.com/gematik/api-ti-messenger/actions/workflows/generate-images.yml"]

image:https://img.shields.io/badge/Release%20Notes-v1.1.1-red?style=plastic&logo=github&logoColor=red[link="ReleaseNotes.md"] +
image:https://img.shields.io/badge/I_TiMessengerContactManagement-v1.0.1-blue?style=plastic&logo=github&logoColor=blue[link=/src/openapi/TiMessengerContactManagement.yaml"] +
image:https://img.shields.io/badge/TiMessengerTestDriver-v0.9.2-purple?style=plastic&logo=github&logoColor=purple[link="/src/openapi/TiMessengerTestTreiber.yaml"]
image:https://img.shields.io/badge/TiMessengerTestSuite-v0.9.2-purple?style=plastic&logo=github&logoColor=purple[link="https://github.com/gematik/TI-Messenger-Testsuite"] +
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;Dienst-v1.1.1-green?style=plastic&logo=github&logoColor=green[link="https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-Dienst_V1.1.1.pdf"]
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;FD-v1.1.1-green?style=plastic&logo=github&logoColor=green[link="https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-FD_V1.1.1.pdf"]
image:https://img.shields.io/badge/TI&hyphen;Messenger&hyphen;Client-v1.1.1-green?style=plastic&logo=github&logoColor=green[link="https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-Client_V1.1.1.pdf"] +
image:https://img.shields.io/badge/Matrix_Client_Server_API-v1.3-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.3/client-server-api/"] 
image:https://img.shields.io/badge/Matrix_Server_Server_API-v1.3-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.3/server-server-api/"] 
image:https://img.shields.io/badge/Matrix_Push_Gateway_API-v1.3-yellow?style=plastic&logo=github&logoColor=yellow[link="https://spec.matrix.org/v1.3/push-gateway-api/"] 

== Ãœberblick
Die folgende Dokumentation ergÃ¤nzt die Spezifikation *TI-Messenger-Dienst* v1.1.1 gemÃ¤ÃŸ *[gemSpec_TI-Messenger-Dienst]*. An dieser Stelle werden insbesondere die in der Spezifikation genannten Komponenten der LÃ¶sung sowie deren Schnittstellen weiter dargestellt und erlÃ¤utert, um Hersteller und Anbieter eines *TI-Messenger-Dienstes* bestmÃ¶glich zu unterstÃ¼tzen. Der Funktionsumfang des *TI-Messenger-Dienst* v1.1.1 beinhaltet: +

* Instant-Messaging zwischen Leistungserbringern und Leistungserbringerinstitutionen und
* Instant-Messaging direkt zwischen Leistungserbringern.

// ðŸ’¡ _Hinweis: In der Spezifikationsversion v1.1.1 kÃ¶nnen keine Versicherten an dem *TI-Messenger-Dienst* teilnehmen_.

IMPORTANT: Die Dokumentation ergÃ¤nzt die Spezifikation gemÃ¤ÃŸ link:https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-Dienst_V1.1.1.pdf[&#91;gemSpec_TI-Messenger-Dienst&#93;], die als Grundlage fÃ¼r das VerstÃ¤ndnis vorrausgesetzt wird. 

== Branches
FÃ¼r die Dokumentation des *TI-Messenger-Dienstes* werden in GitHub die folgenden Branches verwendet:

- `main`: enthÃ¤lt die Dokumentation fÃ¼r das aktuell verÃ¶ffentlichte Release gemÃ¤ÃŸ *[gemSpec_TI-Messenger-Dienst]*,
- `develop`: enthÃ¤lt die Dokumentation der in Entwicklung befindlichen Features, die noch nicht released sind, 
- `hotfix`: enthÃ¤lt die Dokumentation kurzfristig notwendiger Ã„nderungen am aktuellen Release, 
- `feature/*`: enthÃ¤lt eine Vorschau, Vorbereitungen und Diskussion eines neuen Themas, welches noch nicht in der Entwicklung ist. Die Inhalte kÃ¶nnen unvollstÃ¤ndig sein und sich bis zur Fertigstellung noch Ã¤ndern.

== SystemÃ¼bersicht
Die folgende Abbildung gibt einen Ãœberblick Ã¼ber die Systemarchitektur des *TI-Messenger-Dienst* v1.1.1 insbesondere auf die Schnittstellen zwischen den Komponenten, die in den folgenden Kapiteln weiter betrachtet werden. 

image::System_overview.png[width="100%"]

TIP: Auf die Schnittstellen zur Autentisierung am *Auth-Service* des *VZD-FHIR-Directory* wird in der oben gezeigten Abbildung verzichtet. Die Informationen hierzu kÃ¶nnen in dem entsprechenden Kapitel fÃ¼r das *VZD-FHIR-Directory* link:https://github.com/gematik/api-vzd/blob/gemILF_VZD_FHIR_Directory/1.0.1/docs/FHIR_VZD_HOWTO_Authenticate.adoc#2-fhirdirectoryauthenticationapis[hier] nachgelesen werden.

link:docs/Fachdienst/Fachdienst.adoc[*TI Messenger-Fachdienst*]

* link:docs/Fachdienst/Registrierungsdienst.adoc[*Registrierungs-Dienst*] +
Der *Registrierungs-Dienst* bietet drei abstrakte Schnittstellen an. Die Schnittstelle `I_Registration` wird vom *Frontend des Registrierungs-Dienstes* aufgerufen, um eine Organisation beim *Registrierungs-Dienst* zu authentifizieren und *Messenger-Services* zu administrieren. Die Schnittstelle `I_internVerification` wird von den *Messenger-Proxies* aufgerufen, um die FÃ¶derationsliste abzurufen und dient zusÃ¤tzlich der PrÃ¼fung (der beteiligten Akteure) auf existierende VZD-FHIR-EintrÃ¤ge. Die Schnittstelle `I_requestToken` wird vom *Org-Admin-Client* aufgerufen, um Zugang zum *FHIR-Proxy* fÃ¼r die Bearbeitung von FHIR-Ressourcen zu erhalten.

* link:docs/Fachdienst/MessengerService.adoc[*Messenger-Service*] +
Ein *Messenger-Service* besteht aus den Teilkomponenten *Messenger-Proxy* und einem *Matrix-Homeserver*. Die Teilkomponente *Matrix-Homeserver* basiert auf dem offenen Kommunikationsprotokoll Matrix und bietet die `Matrix-Client-Server API` sowie die `Matrix-Server-Server API` an. Die Kommunikation zu einem *Matrix-Homeserver* wird immer Ã¼ber den *Messenger-Proxy* geleitet, sofern die BerechtigungsprÃ¼fung erfolgreich war. Der *Messenger-Proxy* stellt die Schnittstelle `I_TiMessengerContactManagement` bereit, um die Administration der Freigabeliste eines Akteurs zu ermÃ¶glichen. 

* https://spec.matrix.org/v1.3/push-gateway-api/[*Push-Gateway*] +
Das *Push-Gateway* stellt die `Matrix-Push-Gateway API` gemÃ¤ÃŸ der Matrix Spezifikation bereit. Dieses ermÃ¶glicht die Weiterleitung von Benachrichtigungen an Akteure des *TI-Messenger-Dienstes*.

link:docs/Client/Client.adoc[*TI Messenger-Client*] +

* Der *TI-Messenger-Client* basiert auf der `Matrix-Client-Server API`. Er wird durch weitere Funktionsmerkmale erweitert und ruft die Schnittstellen am *TI-Messenger-Fachdienst* sowie am *VZD-FHIR-Directory* auf.

link:docs/FHIR-Directory/FHIR-Directory.adoc[*VZD-FHIR-Directory*] +

* Beim *VZD-FHIR-Directory* handelt es sich um einen zentralen Verzeichnisdient der TI, der die deutschlandweite Suche von Organisationen und Akteuren des *TI-Messenger-Dienstes* ermÃ¶glicht. Das *VZD-FHIR-Directory* basiert auf dem FHIR-Standard und bietet fÃ¼r den *TI-Messenger-Dienst* relevante Schnittstellen an. Die Schnittstelle `FHIRDirectoryTIMProviderAPI` wird vom *Registrierungs-Dienst* aufgerufen, um eine FÃ¶derationsliste herunterzuladen. Die Schnittstellen `FHIRDirectorySearchAPI` und `FHIRDirectoryOwnerAPI` werden von den *TI-Messenger-Clients* aufgerufen, um eine Suche bzw. einen Eintrag im *FHIR-Directory* zu ermÃ¶glichen.

link:docs/IDP/idp.adoc[*Zentraler IDP-Dienst*] +

* Der *Zentrale IDP-Dienst* der gematik Ã¼bernimmt die Aufgabe der smartcard-basierten Authentisierung eines Akteures. Hierbei fasst der *IDP-Dienst* aus der Smartcard notwendige Attribute (z. B. `TelematikID`, `ProfessionOID`) in ein signiertes JSON Web Token (`ID_TOKEN`) zusammen, damit sich ein Client gegenÃ¼ber Fachanwendungen (*Registrierungs-Dienst* und *VZD-FHIR-Directory*) identifizieren kann. 

link:docs/Authenticator/authenticator.adoc[*gematik Authenticator*] +

* Der *Authenticator* der gematik erhÃ¤lt vom *zentralen IDP-Dienst* einen `AUTHORIZATION_CODE` zurÃ¼ck, welcher durch Vorlage vom *Registrierungs-Dienst* oder vom *Auth-Service* des *VZD-FHIR-Directory* am *IDP-Dienst* durch ein `ID_TOKEN` ausgetauscht wird.

== Ordnerstruktur
Im Folgenden sind die wesentlichen Inhalte des Repositories dargestellt.

[{source-style},subs="macros"]
----
TI-Messenger Dokumentation
â”œâ”€ link:docs[docs] (weiterfÃ¼hrende Informationen)
|   â”œâ”€â”€â”€â”€ link:docs/Authenticator[Authenticator]
|   â”œâ”€â”€â”€â”€ link:docs/Client[Client]
|   â”œâ”€â”€â”€â”€ link:docs/FHIR-Directory[FHIR-Directory]
|   â”œâ”€â”€â”€â”€ link:docs/Fachdienst[Fachdienst]
|   â”œâ”€â”€â”€â”€ link:docs/IDP[IDP]
|   â”œâ”€â”€â”€â”€ link:docs/Primaersystem[Primaersystem]
|   â”œâ”€â”€â”€â”€ link:docs/anwendungsfaelle[AnwendungsfÃ¤lle]
|   â”œâ”€â”€â”€â”€ link:docs/anwendungsfaelle/COM-chatbot.adoc[Chatbot]
|   â”œâ”€â”€â”€â”€ link:docs/Test/Test.adoc[Testkonzept]
|   â””â”€â”€â”€â”€ link:docs/FAQ[FAQ]
â”œâ”€ link:images[images] (Bildarchiv)
â”‚   â””â”€â”€â”€â”€ link:images/generated[generated] (draw.io & PlantUML gerenderte Bilder)
â”œâ”€ link:samples[samples] (Codebeispiele, Postman Collections, etc)
â”œâ”€ link:src[src] (Quellen)
â”‚   â”œâ”€â”€â”€â”€ link:src/drawio[drawio] (Quellen der drawio-Diagramme)
â”‚   â”œâ”€â”€â”€â”€ link:src/openapi[openapi] (Schnittstellenbeschreibungen)
â”‚   â”‚    â”œâ”€â”€ link:src/openapi/TiMessengerContactManagement.yaml[TiMessengerContactManagement.yaml] (API-Beschreibung der Freigabeliste)
â”‚   â”‚    â””â”€â”€ link:src/openapi/TiMessengerTestTreiber.yaml[TiMessengerTestTreiber.yaml] (API-Beschreibung der TestTreiber-Schnittstelle)
â”‚   â””â”€â”€â”€â”€ link:src/plantuml[plantuml] (Quellen der plantuml-Diagramme)
â”œâ”€â”€ link:README.adoc[README.adoc]
â”œâ”€â”€ link:CODE_OF_CONDUCT.md[CODE_OF_CONDUCT.md]
â”œâ”€â”€ link:CONTRIBUTING.md[CONTRIBUTING.md]
â”œâ”€â”€ link:LICENSE.md[LICENSE.md]
â”œâ”€â”€ link:Pull_request_template.md[Pull_request_template.md]
â”œâ”€â”€ link:SECURITY.md[SECURITY.md]
â””â”€â”€ link:ReleaseNotes.md[ReleaseNotes.md]
----

== Quellen
Die nachfolgende Tabelle enthÃ¤lt die in der vorliegenden Online Dokumentation referenzierten Dokumente der gematik. 

|===
|[Quelle] |Herausgeber: Titel

|link:https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-Dienst_V1.1.1.pdf[gemSpec_TI-Messenger-Dienst_v1.1.1] |gematik: Spezifikation TI-Messenger-Dienst
|link:https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-FD_V1.1.1.pdf[gemSpec_TI-Messenger-FD_v1.1.1] |gematik: Spezifikation TI-Messenger-Fachdienst
|link:https://fachportal.gematik.de/fachportal-import/files/gemSpec_TI-Messenger-Client_V1.1.1.pdf[gemSpec_TI-Messenger-Client_v1.1.1] |gematik: Spezifikation TI-Messenger-Client
|link:https://fachportal.gematik.de/fachportal-import/files/gemSpec_VZD_FHIR_Directory_V1.3.0.pdf[gemSpec_VZD_FHIR_Directory_v1.3.0] |gematik: Spezifikation Verzeichnisdienst FHIR-Directory
|link:https://fachportal.gematik.de/hersteller-anbieter/komponenten-dienste/identity-provider-idp[zentraler IDP_Dienst] |gematik: zentraler IDP-Dienst der gematik
|link:https://fachportal.gematik.de/hersteller-anbieter/komponenten-dienste/authenticator[Authenticator] |gematik: Authenticator der gematik
|===

== ðŸ’¡ Onboarding
Hersteller und Anbieter eines *TI-Messenger-Dienstes* kÃ¶nnen das von der gematik bereitgestellte https://gematikde.sharepoint.com/:w:/s/PTNeo/EczX7AFGfBdNrCYghzGsHz4BbSoYhV63QMmDCdz7x9zLpg?e=7wG3c[Welcome Package] zum Onboarding nutzen. Dieses Welcome Package ist als "Schritt-fÃ¼r-Schritt"-Anleitung gedacht, um Hersteller und Anbieter beim Onboarding des *TI-Messenger-Dienstes* zu unterstÃ¼tzen.

== WeiterfÃ¼hrende Seiten
*AnwendungsfÃ¤lle* +
link:docs/anwendungsfaelle/TI-Messenger-Anwendungsfaelle.adoc[- AnwendungsfÃ¤lle] 

*Produkttypen* +
link:docs/Fachdienst/Fachdienst.adoc[- TI-Messenger-Fachdienst] +
link:docs/Client/Client.adoc[- TI-Messenger-Client] +
link:docs/FHIR-Directory/FHIR-Directory.adoc[- VZD-FHIR-Directory] +
link:docs/IDP/idp.adoc[- Zentraler IDP-Dienst] +

*Leitfaden fÃ¼r PrimÃ¤rsystemhersteller* +
link:docs/Primaersystem/Primaersystem.adoc[- PrimÃ¤rsystem] +

*Diverses* +
https://gematikde.sharepoint.com/:w:/s/PTNeo/EczX7AFGfBdNrCYghzGsHz4BbSoYhV63QMmDCdz7x9zLpg?e=7wG3c[- Welcome Package &#91;DE&#93;] +
https://gematikde.sharepoint.com/:w:/s/PTNeo/ETwc10F5Ha1KmlM8NEsetl8BtEumSDgu56AK-PNiZ0-e1Q?e=ySZROI[- Welcome Package &#91;EN&#93;] +
https://gematikde.sharepoint.com/sites/EXTAuthenticator/Freigegebene%20Dokumente/Forms/AllItems.aspx?id=%2Fsites%2FEXTAuthenticator%2FFreigegebene%20Dokumente%2FVer%C3%B6ffentlichte%20Version%20%2D%20gematik%20Authenticator&p=true&ga=1[- gematik Authenticator] +
https://github.com/gematik/TI-Messenger-Testsuite[- TI-Messenger-Testsuite] +
link:docs/samples[- Codebeispiele & Requestsammlungen] +
link:docs/FAQ/FAQ.adoc[- Fragen und Antworten zur aktuellen Spezifikation &#91;FAQ&#93;]

*Referenz-Implementierungen* +
- [comming soon]

== Lizenzbedingungen
Copyright (c) 2023 gematik GmbH

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
